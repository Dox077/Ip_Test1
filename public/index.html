<!DOCTYPE html>
<html>
<head>
  <title>Save Username to Google Sheet</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h1>Save Username to Google Sheet</h1>
  <form>
    <label for="username">Enter your username:</label>
    <input type="text" id="username" name="username">
    <button type="button" onclick="saveUsername()">Save</button>
  </form>
  <script>
    function initClient() {
      gapi.client.init({
        apiKey: 'AIzaSyA-hcANdJmipBAeDxGO7A7I2Xao5xex0XE',
        clientId: '1023049278699-489s2oqrr75au1a0e214hjvtqr99kfbk.apps.googleusercontent.com',
        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
        scope: 'https://www.googleapis.com/auth/spreadsheets',
      }).then(() => {
        console.log('Google Sheets API initialized.');
        gapi.auth2.getAuthInstance().signIn().then(() => {
          console.log('User authenticated.');
        }, (error) => {
          console.error('Error authenticating user:', error);
        });
      }, (error) => {
        console.error('Error initializing Google Sheets API:', error);
      });
    }

    async function saveUsername() {
      const username = document.getElementById('username').value;
      const spreadsheetId = '1UDDarsUSFfdEhALQUlPvONklLpR0jzeV5kTaJ6Nslr4'; // Replace with your Google Sheet ID
      const range = 'Sheet1!A1'; // Replace with the desired cell
      const valueInputOption = 'USER_ENTERED';
      const resource = {
        values: [[username]],
      };
      const accessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
      const headers = new Headers();
      headers.append('Authorization', `Bearer ${accessToken}`);
      const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?valueInputOption=${valueInputOption}`, {
        method: 'PUT',
        headers,
        body: JSON.stringify(resource),
      });
      const data = await response.json();
      console.log(`${data.updatedCells} cells updated.`);
    }

    gapi.load('client', initClient);
  </script>
</body>
</html>
