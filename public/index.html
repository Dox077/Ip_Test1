<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IP Address to Google Sheets</title>
</head>
<body>
  <button id="storeButton">Store IP Address</button>

  <!-- Include the JavaScript file -->
  <!-- <script src="https://apis.google.com/js/api.js" onload="handleClientLoad"></script>
  <script src="script.js"></script>
</body>
</html> --> -->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IP Address to Google Sheets</title>
</head>
<body>
  <button id="storeButton" onclick="storeIpAddress()">Store IP Address</button>

  <!-- Add the Google API script -->
  <script src="https://apis.google.com/js/api.js" onload="handleClientLoad()"></script>

  <script>
    // Define your client ID (replace with your actual value)
    const CLIENT_ID = 'YOUR_CLIENT_ID';
    const SPREADSHEET_ID = 'YOUR_SPREADSHEET_ID';

    // Array with Google Sheets API discovery documents
    const DISCOVERY_DOCS = ['https://sheets.googleapis.com/$discovery/rest?version=v4'];

    // Authorized scopes
    const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';

    // Initialize the Google API client
    gapi.load('client:auth2', initClient);

    function initClient() {
      gapi.client.init({
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES,
      }).then(function () {
        // Listen for sign-in state changes
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        // User is signed in, enable the "Store IP Address" button
        document.getElementById('storeButton').disabled = false;
      } else {
        // User is not signed in, disable the "Store IP Address" button
        document.getElementById('storeButton').disabled = true;
      }
    }

    // Handle the click event of the "Store IP Address" button
    function storeIpAddress() {
      fetch('https://api64.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
          const ipAddress = data.ip;
          appendIpAddressToSheet(ipAddress);
        })
        .catch(error => {
          console.error('Error fetching IP address:', error);
        });
    }

    // Append the IP address to the Google Sheet
    function appendIpAddressToSheet(ipAddress) {
      gapi.client.sheets.spreadsheets.values.append({
        spreadsheetId: SPREADSHEET_ID,
        range: 'Ip', // Update with your sheet name and range
        valueInputOption: 'RAW',
        insertDataOption: 'INSERT_ROWS',
        resource: {
          values: [[ipAddress]],
        },
      }).then(function (response) {
        console.log('IP Address stored in Google Sheet:', response);
        alert('IP Address stored in Google Sheet');
      }).catch(function (error) {
        console.error('Error storing IP address in Google Sheet:', error);
        alert('Failed to store IP address in Google Sheet');
      });
    }
  </script>
</body>
</html>

